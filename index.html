<!DOCTYPE html>
<html>
<head>
    <title>SPACE CITY: MEGA-TYCOON</title>
    <style>
        :root { --neon: #00f2ff; --money: #00ff88; --glass: rgba(5, 15, 25, 0.9); }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; }
        
        #ui { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; color: white; 
        }
        #hud { 
            position: absolute; top: 30px; left: 30px; padding: 20px;
            background: var(--glass); border-left: 5px solid var(--neon);
            pointer-events: auto;
        }
        #money-display { font-size: 42px; color: var(--money); font-weight: 900; }
        
        #controls-hint {
            position: absolute; bottom: 30px; right: 30px;
            background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px;
            font-size: 12px; line-height: 1.6; color: var(--neon);
        }

        .build-label {
            position: absolute; background: var(--glass); padding: 10px;
            border: 1px solid var(--neon); border-radius: 4px; font-size: 12px;
            transform: translate(-50%, -100%); pointer-events: none;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
</head>
<body>

    <div id="ui">
        <div id="hud">
            <div style="font-size: 10px; opacity: 0.6; letter-spacing: 2px;">SECTOR FUNDS</div>
            <div id="money-display">§ 5,000</div>
            <div id="stats" style="font-size: 11px; color: var(--neon);">CITIZENS: 0 | INCOME: §0/sec</div>
        </div>

        <div id="controls-hint">
            <b>COMMANDS:</b><br>
            WASD - Move Character<br>
            COLLECT CRATES FOR CASH<br>
            WALK ON RINGS TO BUILD
        </div>
        <div id="labels"></div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020408);
        scene.fog = new THREE.Fog(0x020408, 100, 500);

        const aspect = window.innerWidth / window.innerHeight;
        const camera = new THREE.PerspectiveCamera(60, aspect, 0.1, 2000);
        camera.position.set(100, 100, 100);
        camera.lookAt(0,0,0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.body.appendChild(renderer.domElement);

        // --- LIGHTING ---
        scene.add(new THREE.AmbientLight(0x4040ff, 0.5));
        const sun = new THREE.DirectionalLight(0xffffff, 2);
        sun.position.set(100, 200, 50);
        scene.add(sun);

        // --- WORLD OBJECTS ---
        const floorGeo = new THREE.PlaneGeometry(2000, 2000);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x0a0a0f, roughness: 0.8 });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        const grid = new THREE.GridHelper(2000, 100, 0x00f2ff, 0x111122);
        scene.add(grid);

        // --- PLAYER ---
        const player = new THREE.Group();
        const pBody = new THREE.Mesh(new THREE.CapsuleGeometry(1, 2), new THREE.MeshStandardMaterial({color: 0xffffff}));
        pBody.position.y = 2;
        const pHair = new THREE.Mesh(new THREE.SphereGeometry(0.8), new THREE.MeshStandardMaterial({color: 0xe6be8a}));
        pHair.position.y = 3.5;
        player.add(pBody, pHair);
        scene.add(player);

        // --- GAMEPLAY DATA ---
        let money = 5000, income = 0, citizens = 0;
        const keys = {}, pads = [], crates = [];

        // Realistic Scraper Generator
        function createSkyscraper(x, z, tiers, color) {
            const group = new THREE.Group();
            for(let i=0; i<tiers; i++) {
                const h = 10 + (i * 15);
                const w = 15 - (i * 3);
                const box = new THREE.Mesh(new THREE.BoxGeometry(w, h, w), new THREE.MeshStandardMaterial({color: color}));
                box.position.y = h/2;
                group.add(box);
                
                // Neon Windows
                const win = new THREE.Mesh(new THREE.BoxGeometry(w+0.2, 2, w+0.2), new THREE.MeshBasicMaterial({color: 0x00f2ff}));
                win.position.y = h - 2;
                group.add(win);
            }
            group.position.set(x, 0, z);
            scene.add(group);
        }

        // Pad Creator
        function createBuildPad(x, z, cost, name, callback) {
            const pad = new THREE.Group();
            const ring = new THREE.Mesh(new THREE.TorusGeometry(8, 0.5, 16, 32), new THREE.MeshBasicMaterial({color: 0x00f2ff}));
            ring.rotation.x = -Math.PI/2;
            pad.add(ring);
            pad.position.set(x, 0.5, z);
            
            const label = document.createElement('div');
            label.className = 'build-label';
            label.innerHTML = `${name}<br><b>§${cost}</b>`;
            document.getElementById('labels').appendChild(label);
            
            pad.userData = { cost, callback, label, active: true };
            scene.add(pad);
            pads.push(pad);
        }

        // Crate Spawner
        function spawnCrate() {
            const crate = new THREE.Mesh(new THREE.BoxGeometry(4, 4, 4), new THREE.MeshStandardMaterial({color: 0x00ff88, emissive: 0x00ff88, emissiveIntensity: 0.5}));
            crate.position.set((Math.random()-0.5)*400, 2, (Math.random()-0.5)*400);
            scene.add(crate);
            crates.push(crate);
        }

        // --- INITIAL BUILDINGS ---
        createBuildPad(50, 50, 2000, "RESIDENTIAL TOWER", () => {
            createSkyscraper(50, 50, 3, 0x222233);
            income += 500; citizens += 100;
            createBuildPad(-80, 40, 10000, "ENERGY CORE", () => {
                createSkyscraper(-80, 40, 5, 0x332244);
                income += 2500;
            });
        });

        for(let i=0; i<5; i++) spawnCrate();
        setInterval(spawnCrate, 8000);

        // --- CONTROLS ---
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);
            const speed = 1.2;
            if(keys['KeyW']) player.position.z -= speed;
            if(keys['KeyS']) player.position.z += speed;
            if(keys['KeyA']) player.position.x -= speed;
            if(keys['KeyD']) player.position.x += speed;

            // Camera follow
            camera.position.lerp(new THREE.Vector3(player.position.x + 80, player.position.y + 80, player.position.z + 80), 0.05);
            camera.lookAt(player.position);

            // Money logic
            money += income/60;
            document.getElementById('money-display').innerText = "§ " + Math.floor(money).toLocaleString();
            document.getElementById('stats').innerText = `CITIZENS: ${citizens} | INCOME: §${Math.floor(income)}/sec`;

            // Crate Collection
            crates.forEach((c, i) => {
                c.rotation.y += 0.02;
                if(player.position.distanceTo(c.position) < 8) {
                    money += 2500;
                    scene.remove(c);
                    crates.splice(i, 1);
                }
            });

            // Pad Collision
            pads.forEach(p => {
                if(!p.userData.active) return;
                
                // Update Label Position
                const vector = p.position.clone().project(camera);
                p.userData.label.style.left = (vector.x * 0.5 + 0.5) * window.innerWidth + 'px';
                p.userData.label.style.top = (-vector.y * 0.5 + 0.5) * window.innerHeight + 'px';

                if(player.position.distanceTo(p.position) < 10 && money >= p.userData.cost) {
                    money -= p.userData.cost;
                    p.userData.active = false;
                    p.userData.label.style.display = 'none';
                    p.userData.callback();
                    scene.remove(p);
                }
            });

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
